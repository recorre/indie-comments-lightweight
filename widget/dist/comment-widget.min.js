async function fetchWithRetry(e,t,n=2){for(let r=0;r<=n;r++)try{const n=await fetch(e,t);if(n.ok||n.status<500)return n;throw new Error(`Server error: ${n.status}`)}catch(e){if(r===n)throw e;console.warn(`Fetch failed, retrying in 1 second... (Attempt ${r+1}/${n+1})`,e),await new Promise(e=>setTimeout(e,1e3))}}export async function createThread(e,t){try{const n=await fetchWithRetry(`${e}/threads`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`Failed to create thread: ${n.statusText}`);return n.json()}catch(e){throw console.error("Error creating thread:",e),e.message.startsWith("Server error")||e.message.startsWith("Failed to create thread")?new Error("Erro no servidor. Tente novamente mais tarde."):new Error("N√£o foi poss√≠vel conectar. Tente novamente em instantes.")}}export async function fetchComments(e,t){try{const n=await fetchWithRetry(`${e}/comments?thread_id=${t}&status=approved`);if(!n.ok)throw new Error(`Failed to fetch comments: ${n.statusText}`);const r=await n.json();return Array.isArray(r.data)?r.data:[]}catch(e){throw console.error("Error fetching comments:",e),e.message.startsWith("Server error")||e.message.startsWith("Failed to fetch comments")?new Error("Erro no servidor. Tente novamente mais tarde."):new Error("N√£o foi poss√≠vel conectar. Tente novamente em instantes.")}}class CommentForm extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.state={submitting:!1,error:null,successMessage:null}}static get observedAttributes(){return["thread-id","api-base-url"]}connectedCallback(){this.render(),this.bindEvents()}attributeChangedCallback(e,t,n){t!==n&&("thread-id"!==e&&"api-base-url"!==e||this.render())}get threadId(){return this.getAttribute("thread-id")}get apiBaseUrl(){return this.getAttribute("api-base-url")||"http://localhost:3001/api"}render(){const e=`\n      <style>\n        :host {\n          display: block;\n        }\n        \n        .comment-form {\n          background-color: #f9fafb;\n          padding: 1rem;\n          border-radius: 0.5rem;\n          border: 1px solid #e5e7eb;\n        }\n        \n        .form-title {\n          margin-top: 0;\n          margin-bottom: 1rem;\n          font-size: 1.125rem;\n          font-weight: 600;\n          color: #1f2937;\n        }\n        \n        .form-group {\n          margin-bottom: 1rem;\n        }\n        \n        label {\n          display: block;\n          margin-bottom: 0.5rem;\n          font-weight: 500;\n          color: #374151;\n        }\n        \n        input, textarea {\n          width: 100%;\n          padding: 0.5rem;\n          border: 1px solid #d1d5db;\n          border-radius: 0.375rem;\n          font-size: 1rem;\n        }\n        \n        textarea {\n          min-height: 100px;\n          resize: vertical;\n        }\n        \n        .submit-btn {\n          background-color: #3b82f6;\n          color: white;\n          border: none;\n          padding: 0.5rem 1rem;\n          border-radius: 0.375rem;\n          cursor: pointer;\n          font-weight: 500;\n        }\n        \n        .submit-btn:hover {\n          background-color: #2563eb;\n        }\n        \n        .submit-btn:disabled {\n          background-color: #9ca3af;\n          cursor: not-allowed;\n        }\n        \n        .error {\n          color: #dc2626;\n          background-color: #fef2f2;\n          padding: 0.5rem;\n          border-radius: 0.375rem;\n          margin: 0.5rem 0;\n        }\n        \n        .success {\n          color: #16a34a;\n          background-color: #f0fdf4;\n          padding: 0.5rem;\n          border-radius: 0.375rem;\n          margin: 0.5rem 0;\n        }\n\n        .loading {\n          color: #374151;\n          font-style: italic;\n        }\n      </style>\n      \n      <div class="comment-form">\n        <h4 class="form-title">Add a Comment</h4>\n        ${this.renderError()}\n        ${this.renderSuccessMessage()}\n        <form id="commentForm">\n          <div class="form-group">\n            <label for="authorName">Name *</label>\n            <input type="text" id="authorName" name="authorName" required />\n          </div>\n          \n          <div class="form-group">\n            <label for="authorEmail">Email</label>\n            <input type="email" id="authorEmail" name="authorEmail" />\n          </div>\n          \n          <div class="form-group">\n            <label for="authorWebsite">Website</label>\n            <input type="url" id="authorWebsite" name="authorWebsite" />\n          </div>\n          \n          <div class="form-group">\n            <label for="commentMessage">Comment *</label>\n            <textarea id="commentMessage" name="commentMessage" required></textarea>\n          </div>\n          \n          <button type="submit" class="submit-btn" ${this.state.submitting?"disabled":""}>\n            ${this.state.submitting?"Enviando...":"Enviar"}\n          </button>\n        </form>\n      </div>\n    `;this.shadowRoot.innerHTML=e}renderError(){return this.state.error?`<div class="error">${this.state.error}</div>`:""}renderSuccessMessage(){return this.state.successMessage?`<small class="success">${this.state.successMessage}</small>`:""}_updateStateAndRender(e){this.state={...this.state,...e},this.render()}bindEvents(){const e=this.shadowRoot.getElementById("commentForm");e&&e.addEventListener("submit",this.handleSubmit.bind(this))}validateForm(e){return e.author_name.trim()?e.author_name.trim().length<3?"O nome deve ter pelo menos 3 caracteres.":e.message.trim()?e.message.trim().length<5?"A mensagem deve ter pelo menos 5 caracteres.":null:"A mensagem do coment√°rio √© obrigat√≥ria.":"O nome √© obrigat√≥rio."}async handleSubmit(e){if(e.preventDefault(),this.state.submitting)return;const t=e.target,n=new FormData(t),r={thread_id:this.threadId,author_name:n.get("authorName"),author_email:n.get("authorEmail")||null,author_website:n.get("authorWebsite")||null,message:n.get("commentMessage"),status:"pending"},o=this.validateForm(r);if(o)this._updateStateAndRender({error:o});else{this._updateStateAndRender({submitting:!0,error:null});try{const e=await fetch(`${this.apiBaseUrl}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),n=await e.json();if(!e.ok)throw new Error(n.message||"Erro ao enviar o coment√°rio. Tente novamente.");t.reset(),this.onCommentSubmitted&&this.onCommentSubmitted(n),this._updateStateAndRender({submitting:!1,error:null,successMessage:"‚úÖ Coment√°rio enviado com sucesso!"}),setTimeout(()=>{this._updateStateAndRender({successMessage:null})},3e3)}catch(e){console.error("Erro ao enviar o coment√°rio:",e);let t="Ocorreu um erro de rede. Verifique sua conex√£o.";e.message.includes("Erro no servidor")||e.message.includes("Failed to create thread")?t="Erro no servidor. Tente novamente mais tarde.":e.message.includes("N√£o foi poss√≠vel conectar")&&(t="N√£o foi poss√≠vel conectar. Tente novamente em instantes."),this._updateStateAndRender({submitting:!1,error:t,successMessage:null})}}}}customElements.define("comment-form",CommentForm),"undefined"!=typeof module&&module.exports&&(module.exports=CommentForm);export function getCachedComments(){const e=localStorage.getItem("indie_comments_cache");if(!e)return null;const{timestamp:t,comments:n}=JSON.parse(e);return Date.now()-t<6e4?n:(localStorage.removeItem("indie_comments_cache"),null)}export function setCachedComments(e){const t={timestamp:Date.now(),comments:e};localStorage.setItem("indie_comments_cache",JSON.stringify(t))}class CommentList extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.state={comments:[],loading:!1}}static get observedAttributes(){return["comments"]}connectedCallback(){const e=this.getAttribute("comments");if(e)try{this.state.comments=JSON.parse(e)||[]}catch(e){console.error("Error parsing comments attribute:",e),this.state.comments=[]}this.render()}attributeChangedCallback(e,t,n){if("comments"===e&&t!==n){try{this.state.comments=n?JSON.parse(n):[]}catch(e){console.error("Error parsing comments attribute:",e),this.state.comments=[]}this.render()}}render(){this.shadowRoot.innerHTML="\n      <style>\n        :host {\n          display: block;\n        }\n        \n        .comments-container {\n          margin-top: 1rem;\n        }\n        \n        .comment {\n          padding: 1rem;\n          margin-bottom: 1rem;\n          border: 1px solid #e5e7eb;\n          border-radius: 0.5rem;\n          background-color: #fff;\n        }\n        \n        .comment-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 0.5rem;\n          padding-bottom: 0.25rem;\n          border-bottom: 1px solid #f3f4f6;\n        }\n        \n        .comment-author {\n          font-weight: 600;\n          color: #1f2937;\n        }\n        \n        .comment-date {\n          font-size: 0.875rem;\n          color: #6b7280;\n        }\n        \n        .comment-content {\n          line-height: 1.6;\n          color: #374151;\n        }\n        \n        .comment-content a {\n          color: #3b82f6;\n          text-decoration: underline;\n        }\n        \n        .comment-content a:hover {\n          color: #2563eb;\n        }\n        \n        .reply-link {\n          margin-top: 0.5rem;\n          font-size: 0.875rem;\n        }\n        \n        .reply-link a {\n          color: #3b82f6;\n          text-decoration: underline;\n          cursor: pointer;\n        }\n        \n        .replies {\n          margin-top: 1rem;\n          padding-left: 1.5rem;\n          border-left: 2px solid #e5e7eb;\n        }\n      </style>\n    ";const e=document.createElement("div");e.classList.add("comments-container"),e.appendChild(this.renderComments()),this.shadowRoot.appendChild(e)}renderComments(){if(!this.state.comments||0===this.state.comments.length){const e=document.createElement("p");e.textContent="No comments yet. Be the first to comment!";const t=document.createDocumentFragment();return t.appendChild(e),t}const e=this.groupCommentsByParent(this.state.comments);return this.renderCommentTree(e,null)}groupCommentsByParent(e){const t={};return e.forEach(e=>{const n=e.parent_id||null;t[n]||(t[n]=[]),t[n].push(e)}),t}renderCommentTree(e,t){const n=e[t]||[],r=document.createDocumentFragment();return n.forEach(t=>{r.appendChild(this._createCommentElement(t,e))}),r}formatContent(e){if("string"!=typeof e)return"";let t=e;t=t.replace(/^# (.*$)/gm,"<h3>$1</h3>"),t=t.replace(/^## (.*$)/gm,"<h4>$1</h4>"),t=t.replace(/^### (.*$)/gm,"<h5>$1</h5>"),t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/__(.*?)__/g,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t=t.replace(/_(.*?)_/g,"<em>$1</em>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"),t=t.replace(/^\s*\*\s(.*)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)/gs,"<ul>$1</ul>"),t=t.replace(/\n/g,"<br>");const n=this.sanitizeHtml(t),r=document.createDocumentFragment();for(;n.firstChild;)r.appendChild(n.firstChild);return r}sanitizeHtml(e){const t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e,this.sanitizeElement(n);n.firstChild;)t.appendChild(n.firstChild);return t}sanitizeElement(e){const t=[];for(const n of Array.from(e.childNodes))if(n.nodeType===Node.ELEMENT_NODE)if(this.isAllowedTag(n.tagName.toLowerCase()))this.sanitizeAttributes(n),this.sanitizeElement(n);else if("script"!==n.tagName.toLowerCase()&&"style"!==n.tagName.toLowerCase()){const e=n.parentNode;for(;n.firstChild;)e.insertBefore(n.firstChild,n);t.push(n)}else t.push(n);else n.nodeType,Node.TEXT_NODE;t.forEach(e=>e.remove())}isAllowedTag(e){return["p","br","strong","em","h3","h4","h5","a","code","pre","ul","li","blockquote"].includes(e)}sanitizeAttributes(e){const t=e.tagName.toLowerCase(),n={a:["href","target","rel"],img:["src","alt","title"]}[t]||[],r=[];for(const t of Array.from(e.attributes))n.includes(t.name)||r.push(t.name);r.forEach(t=>e.removeAttribute(t)),"a"===t&&e.href&&(e.href.startsWith("http")||e.href.startsWith("mailto:")||(e.href="#"))}formatDate(e){if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return e;const n=new Date,r=Math.abs(n-t),o=Math.ceil(r/864e5);return 1===o?"Yesterday":0===o?"Today":t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}formatDate(e){if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return e;const n=new Date,r=Math.abs(n-t),o=Math.ceil(r/864e5);return 1===o?"Yesterday":0===o?"Today":t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}_createCommentElement(e,t){const n=document.createElement("div");n.classList.add("comment"),n.dataset.commentId=e.id;const r=document.createElement("div");r.classList.add("comment-header");const o=document.createElement("div");o.classList.add("comment-author"),o.textContent=e.author_name;const a=document.createElement("div");a.classList.add("comment-date"),a.textContent=this.formatDate(e.created_at),r.appendChild(o),r.appendChild(a),n.appendChild(r);const s=document.createElement("div");s.classList.add("comment-content");const i=this.formatContent(e.message);s.appendChild(i),n.appendChild(s);const m=document.createElement("div");m.classList.add("reply-link");const c=document.createElement("a");c.href="#",c.textContent="Reply",c.onclick=t=>{t.preventDefault(),console.log(`Reply to comment ${e.id}`)},m.appendChild(c),n.appendChild(m);const d=t[e.id];if(d&&d.length>0){const e=document.createElement("div");e.classList.add("replies"),d.forEach(n=>{e.appendChild(this._createCommentElement(n,t))}),n.appendChild(e)}return n}}customElements.define("comment-list",CommentList),"undefined"!=typeof module&&module.exports&&(module.exports=CommentList);import{createTemplate}from"./template.js";import{createThread,fetchComments}from"./api.js";import{getCachedComments,setCachedComments}from"./comment-list.js";class CommentWidget extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.commentObserver=null,this.state={comments:[],isLoading:!1,error:null,threadId:null,message:null}}static get observedAttributes(){return["thread-id","page-title","api-base-url"]}connectedCallback(){this._injectPicoCssIfNeeded(),this._applyThemeFromUrl(),this.render(),this._setupIntersectionObserver(),this._setupThemeSelector(),this._applyStoredTheme()}attributeChangedCallback(e,t,n){t!==n&&"thread-id"===e&&(this.state.threadId=n)}get apiBaseUrl(){return this.getAttribute("api-base-url")||"http://localhost:3001/api"}render(){this.shadowRoot.innerHTML=createTemplate(this.state,this.apiBaseUrl,this.state.message,this.state.currentTheme||"default");const e=this.shadowRoot.querySelector("comment-list");e&&(e.comments=this.state.comments);const t=this.shadowRoot.querySelector("comment-form");t&&(t.onCommentSubmitted=this._handleNewComment.bind(this))}_setState(e){Object.assign(this.state,e),this.render()}_setupIntersectionObserver(){this.commentObserver=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(this._initializeThread(),t.disconnect())})},{threshold:.1}),this.commentObserver.observe(this)}async _initializeThread(){const e=this.getAttribute("thread-id");e?(this._setState({threadId:e}),this._loadComments()):await this._createThreadForPage()}async _createThreadForPage(){this._setState({isLoading:!0,error:null});try{const e={site_id:1,page_url:window.location.href,page_title:this.getAttribute("page-title")||document.title},t=await createThread(this.apiBaseUrl,e);this.setAttribute("thread-id",t.id)}catch(e){console.error("Error creating thread:",e);let t="Erro ao carregar coment√°rios. Tente novamente.";e.message.includes("Erro no servidor")?t="Erro no servidor. Tente novamente mais tarde.":e.message.includes("N√£o foi poss√≠vel conectar")&&(t="N√£o foi poss√≠vel conectar. Tente novamente em instantes."),this._setState({error:t,isLoading:!1})}}async _loadComments(){if(this.state.threadId){this._setState({isLoading:!0,error:null});try{const e=getCachedComments();if(e)return void this._setState({comments:e,isLoading:!1,message:"Exibindo coment√°rios armazenados localmente"});const t=await fetchComments(this.apiBaseUrl,this.state.threadId);setCachedComments(t),this._setState({comments:t,isLoading:!1,message:null})}catch(e){console.error("Error loading comments:",e);const t=getCachedComments();if(t)this._setState({comments:t,isLoading:!1,message:"Exibindo coment√°rios armazenados localmente (offline)"});else{let t="Erro ao carregar coment√°rios. Tente novamente.";e.message.includes("Erro no servidor")?t="Erro no servidor. Tente novamente mais tarde.":e.message.includes("N√£o foi poss√≠vel conectar")&&(t="N√£o foi poss√≠vel conectar. Tente novamente em instantes."),this._setState({error:t,isLoading:!1,message:null})}}}}_injectPicoCssIfNeeded(){if(document.querySelector('link[href*="pico.min.css"]'))return;const e=document.createElement("link");e.rel="stylesheet",e.href="css/pico.min.css",document.head.appendChild(e)}_handleNewComment(e){this._setState({comments:[...this.state.comments,e]})}_setupThemeSelector(){const e=this.shadowRoot.getElementById("themeSelect");e&&e.addEventListener("change",e=>{this._changeTheme(e.target.value)})}_changeTheme(e){if(this._removeExistingTheme(),e&&"default"!==e){const t=document.createElement("link");t.rel="stylesheet",t.href=`css/themes/${e}.css`,t.setAttribute("data-theme","indie-comments"),document.head.appendChild(t)}e&&"default"!==e?this._updateUrlWithTheme(e):this._removeThemeFromUrl(),this._saveThemeToStorage(e),this.state.currentTheme=e,this.render()}_removeExistingTheme(){document.querySelectorAll('link[data-theme="indie-comments"]').forEach(e=>e.remove())}_saveThemeToStorage(e){try{localStorage.setItem("indie_comments_theme",e)}catch(e){console.warn("Could not save theme preference to localStorage:",e)}}_applyStoredTheme(){try{const e=localStorage.getItem("indie_comments_theme");if(e){const t=this.shadowRoot.getElementById("themeSelect");t&&(t.value=e),this._changeTheme(e)}}catch(e){console.warn("Could not retrieve theme preference from localStorage:",e)}}_applyThemeFromUrl(){try{const e=new URLSearchParams(window.location.search).get("theme");if(e){const t=this.shadowRoot.getElementById("themeSelect");t&&(t.value=e),this._changeTheme(e)}}catch(e){console.warn("Could not retrieve theme from URL:",e)}}_updateUrlWithTheme(e){try{const t=new URL(window.location);t.searchParams.set("theme",e),window.history.replaceState({},document.title,t.toString())}catch(e){console.warn("Could not update URL with theme parameter:",e)}}_removeThemeFromUrl(){try{const e=new URL(window.location);e.searchParams.has("theme")&&(e.searchParams.delete("theme"),window.history.replaceState({},document.title,e.toString()))}catch(e){console.warn("Could not remove theme parameter from URL:",e)}}}customElements.define("comment-widget",CommentWidget);export function createTemplate(e,t,n=null,r="default"){const o=e.comments?e.comments.length:0;function a(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}return`\n    <style>\n      :host {\n        display: block;\n        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";\n      }\n\n      ${"dark"===r?"\n      /* Dark Theme Styles */\n      :host {\n        --bg-color: #1a1a1a;\n        --text-color: #f0f0f0;\n        --border-color: #444;\n        --button-bg: #333;\n        --button-hover: #555;\n        --input-bg: #2a2a2a;\n        --input-border: #555;\n        --card-bg: #222;\n      }\n      .comment-widget {\n        margin: 1.5rem 0;\n        padding: 1rem;\n        border: 1px solid var(--border-color);\n        border-radius: 0.5rem;\n        background-color: var(--card-bg);\n        color: var(--text-color);\n      }\n      .loading {\n        text-align: center;\n        padding: 1rem;\n        color: var(--text-color);\n      }\n      .error {\n        color: #f87171;\n        background-color: #450a0a;\n        padding: 0.75rem;\n        border-radius: 0.375rem;\n        margin: 0.5rem 0;\n      }\n      .comment-form-container {\n        margin-bottom: 1.5rem;\n      }\n      .comments-header {\n        margin-bottom: 1rem;\n        padding-bottom: 0.5rem;\n        border-bottom: 1px solid var(--border-color);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        color: var(--text-color);\n      }\n      .comments-count {\n        font-weight: 600;\n        color: var(--text-color);\n        font-size: 1.1rem;\n      }\n      .theme-selector select {\n        padding: 0.25rem 0.5rem;\n        border: 1px solid var(--input-border);\n        border-radius: 0.25rem;\n        font-size: 0.85rem;\n        background-color: var(--input-bg);\n        color: var(--text-color);\n      }\n      .info-message {\n        background-color: #1e3a8a;\n        color: #bfdbfe;\n        border: 1px solid #3730a3;\n      }\n      ":"matrix"===r?"\n      /* Matrix Theme Styles */\n      :host {\n        --bg-color: #000;\n        --text-color: #0f0;\n        --border-color: #0a0;\n        --button-bg: #020;\n        --button-hover: #040;\n        --input-bg: #010;\n        --input-border: #080;\n        --card-bg: #000;\n      }\n      .comment-widget {\n        margin: 1.5rem 0;\n        padding: 1rem;\n        border: 1px solid var(--border-color);\n        border-radius: 0.5rem;\n        background-color: var(--card-bg);\n        color: var(--text-color);\n        font-family: 'Courier New', monospace;\n      }\n      .loading {\n        text-align: center;\n        padding: 1rem;\n        color: var(--text-color);\n      }\n      .error {\n        color: #f87171;\n        background-color: #1c1917;\n        padding: 0.75rem;\n        border-radius: 0.375rem;\n        margin: 0.5rem 0;\n        border: 1px solid var(--border-color);\n      }\n      .comment-form-container {\n        margin-bottom: 1.5rem;\n      }\n      .comments-header {\n        margin-bottom: 1rem;\n        padding-bottom: 0.5rem;\n        border-bottom: 1px dashed var(--border-color);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        color: var(--text-color);\n      }\n      .comments-count {\n        font-weight: 600;\n        color: var(--text-color);\n        font-size: 1.1rem;\n      }\n      .theme-selector select {\n        padding: 0.25rem 0.5rem;\n        border: 1px solid var(--input-border);\n        border-radius: 0.25rem;\n        font-size: 0.85rem;\n        background-color: var(--input-bg);\n        color: var(--text-color);\n        font-family: 'Courier New', monospace;\n      }\n      .info-message {\n        background-color: #1e3a8a;\n        color: #bfdbfe;\n        border: 1px solid #3730a3;\n      }\n      ":"neocities"===r?"\n      /* NeoCities Theme Styles */\n      :host {\n        --bg-color: #ffffcc;\n        --text-color: #330033;\n        --border-color: #996699;\n        --button-bg: #ffccff;\n        --button-hover: #ff99ff;\n        --input-bg: #ffff99;\n        --input-border: #669966;\n        --card-bg: #ccffff;\n      }\n      .comment-widget {\n        margin: 1.5rem 0;\n        padding: 1rem;\n        border: 2px dashed var(--border-color);\n        border-radius: 0.5rem;\n        background: linear-gradient(135deg, #ffffcc, #ffccff);\n        color: var(--text-color);\n      }\n      .loading {\n        text-align: center;\n        padding: 1rem;\n        color: var(--text-color);\n      }\n      .error {\n        color: var(--text-color);\n        background-color: #fca5a5;\n        padding: 0.75rem;\n        border-radius: 0.375rem;\n        margin: 0.5rem 0;\n        border: 2px solid #b91c1c;\n      }\n      .comment-form-container {\n        margin-bottom: 1.5rem;\n      }\n      .comments-header {\n        margin-bottom: 1rem;\n        padding-bottom: 0.5rem;\n        border-bottom: 1px dotted var(--border-color);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        color: var(--text-color);\n      }\n      .comments-count {\n        font-weight: 600;\n        color: var(--text-color);\n        font-size: 1.1rem;\n      }\n      .theme-selector select {\n        padding: 0.25rem 0.5rem;\n        border: 2px dotted var(--input-border);\n        border-radius: 0.25rem;\n        font-size: 0.85rem;\n        background-color: var(--input-bg);\n        color: var(--text-color);\n        font-family: 'Courier New', monospace;\n      }\n      .info-message {\n        background-color: #a5b4fc;\n        color: #3730a3;\n        border: 1px solid #4f46e5;\n      }\n      ":"\n      /* Default/Pico CSS compatible styles */\n      .comment-widget {\n        margin: 1.5rem 0;\n        padding: 1rem;\n        border: 1px solid #d1d5db;\n        border-radius: 0.5rem;\n        background-color: #fff;\n      }\n      .loading {\n        text-align: center;\n        padding: 1rem;\n      }\n      .error {\n        color: #dc2626;\n        background-color: #fef2f2;\n        padding: 0.75rem;\n        border-radius: 0.375rem;\n        margin: 0.5rem 0;\n      }\n      .comment-form-container {\n        margin-bottom: 1.5rem;\n      }\n      .comments-header {\n        margin-bottom: 1rem;\n        padding-bottom: 0.5rem;\n        border-bottom: 1px solid #e5e7eb;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      .comments-count {\n        font-weight: 600;\n        color: #374151;\n        font-size: 1.1rem;\n      }\n      .theme-selector select {\n        padding: 0.25rem 0.5rem;\n        border: 1px solid #d1d5db;\n        border-radius: 0.25rem;\n        font-size: 0.85rem;\n        background-color: #fff;\n      }\n      "}\n    </style>\n\n    <div class="comment-widget">\n      <div class="comments-header">\n        <div class="comments-count">üí¨ ${o} ${1===o?"coment√°rio":"coment√°rios"}</div>\n        <div class="theme-selector">\n          <label for="themeSelect">Tema:</label>\n          <select id="themeSelect">\n            <option value="default">Padr√£o</option>\n            <option value="dark">Dark</option>\n            <option value="matrix">Matrix</option>\n            <option value="neocities">NeoCities</option>\n          </select>\n        </div>\n      </div>\n      <style>\n        .info-message {\n          background-color: #e0f2fe; /* Light blue background */\n          color: #0288d1; /* Darker blue text */\n          padding: 0.75rem;\n          border-radius: 0.375rem;\n          margin-bottom: 1rem;\n          border: 1px solid #90caf9; /* Border color */\n          font-size: 0.9rem;\n          text-align: center;\n        }\n      </style>\n      \n      ${e.isLoading?'<div class="loading">Carregando coment√°rios...</div>':""}\n      ${e.error?`<div class="error">Error: ${a(e.error)}</div>`:""}\n      ${n?`<div class="info-message">${a(n)}</div>`:""}\n      \n      <div class="comment-form-container">\n        <comment-form thread-id="${e.threadId}" api-base-url="${t}"></comment-form>\n      </div>\n      \n      <div class="comments-container">\n        <comment-list></comment-list>\n      </div>\n    </div>\n  `}